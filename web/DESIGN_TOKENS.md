# Hybrid Portal Design System

This document describes the three-layer design token system and layout configuration for LostCity portals.

## Part 1: Three-Layer Design Token System

The design token system provides a structured way to customize portal appearance while maintaining consistency.

### Layer 1: Primitives (Generated from Portal Config)

Primitives are the raw color values from `portal.branding`. These are automatically generated by `PortalTheme.tsx`:

```css
--primitive-primary-500     /* From branding.primary_color */
--primitive-primary-rgb     /* RGB values for opacity */
--primitive-secondary-500   /* From branding.secondary_color */
--primitive-secondary-rgb
--primitive-accent-500      /* From branding.accent_color */
--primitive-accent-rgb
```

### Layer 2: Semantic Tokens (Intent-Based)

Semantic tokens map primitives to UI concepts:

```css
/* Brand */
--brand-primary
--brand-secondary
--brand-accent

/* Actions */
--action-primary
--action-primary-hover
--action-secondary
--action-secondary-hover

/* States */
--state-selected
--state-selected-bg
--focus-ring-color

/* Surfaces */
--surface-base
--surface-raised
--surface-elevated

/* Text */
--text-primary
--text-secondary
--text-muted
--text-inverse
--text-link
--text-link-hover
```

### Layer 3: Component Tokens

Component tokens are UI-specific:

```css
/* Buttons */
--btn-primary-bg
--btn-primary-text
--btn-primary-hover
--btn-secondary-bg
--btn-secondary-border

/* Navigation */
--nav-tab-text
--nav-tab-active
--nav-indicator

/* Cards */
--card-bg
--card-border
--card-border-hover

/* Badges */
--badge-bg
--badge-text
--badge-accent-bg
```

### Backwards Compatibility

Existing components continue to work with legacy tokens:
- `--coral` → `var(--brand-primary)`
- `--neon-cyan` → `var(--brand-secondary)`
- `--gold` → `var(--brand-accent)`

## Part 2: Feed Layout Configuration

Configure feed layouts via `portal.settings.feed_config`:

```typescript
interface PortalFeedConfig {
  layout: "vertical" | "horizontal" | "grid" | "masonry" | "timeline";
  card_variant: "compact" | "standard" | "hero" | "poster" | "minimal";
  sections: Array<"featured" | "for_you" | "trending" | "by_category" | "friends_activity">;
  hero_style: "carousel" | "single" | "none";
  show_filters: boolean;
  group_by: "none" | "date" | "category" | "neighborhood";
}
```

### Layout Types

- **vertical**: Traditional single-column scrolling feed (default)
- **horizontal**: Scrollable rows with sections
- **grid**: Responsive card grid
- **masonry**: Pinterest-style image-heavy layout (TODO)
- **timeline**: Date-grouped chronological view (TODO)

### Card Variants

- **compact**: Minimal info, high density
- **standard**: Balanced info and imagery (default)
- **hero**: Large images, cinematic
- **poster**: Image-focused with minimal text
- **minimal**: Text-only, no images

### Example Configuration

```sql
UPDATE portals
SET settings = jsonb_set(
  settings,
  '{feed_config}',
  '{
    "layout": "grid",
    "card_variant": "poster",
    "sections": ["featured", "trending"],
    "hero_style": "carousel",
    "show_filters": true,
    "group_by": "category"
  }'::jsonb
)
WHERE slug = 'my-portal';
```

## Part 3: Page Template System

Override the default feed template with custom layouts.

### Templates

Located in `/app/[portal]/_templates/`:

- **default.tsx**: Standard feed (uses FeedShell)
- **gallery.tsx**: Image-heavy masonry layout
- **timeline.tsx**: Date-grouped chronological view

### Configuration

Set `portal.page_template` in the database:

```sql
UPDATE portals
SET page_template = 'gallery'
WHERE slug = 'my-portal';
```

Options:
- `"default"` (or null): Standard feed
- `"gallery"`: Image-focused masonry
- `"timeline"`: Chronological event schedule
- `"custom"`: Reserved for future custom components

### Custom Components

For maximum flexibility, override specific components:

```sql
UPDATE portals
SET custom_components = '{
  "feed": "@/components/custom/MyCustomFeed",
  "header": "@/components/custom/MyCustomHeader"
}'::jsonb
WHERE slug = 'my-portal';
```

## Usage Examples

### Using Design Tokens in Components

```tsx
// Use semantic tokens for intent-based styling
<button className="bg-[var(--action-primary)] hover:bg-[var(--action-primary-hover)]">
  Click me
</button>

// Use component tokens for specific UI elements
<div className="bg-[var(--card-bg)] border border-[var(--card-border)]">
  Card content
</div>
```

### Using Layout Components

```tsx
import { VerticalFeed, GridFeed } from "@/components/feed/layouts";

// Vertical layout
<VerticalFeed config={feedConfig}>
  {events.map(event => <EventCard key={event.id} event={event} />)}
</VerticalFeed>

// Grid layout
<GridFeed config={feedConfig}>
  {events.map(event => <EventCard key={event.id} event={event} />)}
</GridFeed>
```

### Using FeedRenderer

```tsx
import { FeedRenderer } from "@/components/feed/FeedRenderer";

<FeedRenderer portal={portal}>
  {events.map(event => <EventCard key={event.id} event={event} />)}
</FeedRenderer>
```

## Migration Guide

### Existing Portals

No action required. All existing portals continue to work with:
- Default `vertical` layout
- `standard` card variant
- `default` page template

### New Portals

1. Use semantic tokens in new components:
   ```tsx
   // Old
   className="text-[var(--coral)]"

   // New (but old still works)
   className="text-[var(--brand-primary)]"
   ```

2. Configure feed layout if needed:
   ```sql
   UPDATE portals
   SET settings = jsonb_set(
     settings,
     '{feed_config}',
     '{"layout": "grid", "card_variant": "poster"}'::jsonb
   )
   WHERE slug = 'new-portal';
   ```

3. Choose appropriate template:
   - Most portals: Keep default
   - Image-heavy content: Use `gallery`
   - Conference/schedule: Use `timeline`

## Files Modified/Created

### Modified
- `/app/globals.css` - Added three-layer token system
- `/components/PortalTheme.tsx` - Generate primitive tokens
- `/lib/portal-context.tsx` - Added feed config and template types
- `/app/[portal]/page.tsx` - Template selection logic

### Created
- `/components/feed/layouts/VerticalFeed.tsx`
- `/components/feed/layouts/GridFeed.tsx`
- `/components/feed/layouts/HorizontalFeed.tsx`
- `/components/feed/layouts/index.ts`
- `/components/feed/FeedRenderer.tsx`
- `/app/[portal]/_templates/default.tsx`
- `/app/[portal]/_templates/gallery.tsx`
- `/app/[portal]/_templates/timeline.tsx`
- `/lib/feed-config.ts`

## Next Steps

1. Implement masonry layout for gallery template
2. Implement timeline layout with date grouping
3. Create card variant components (compact, hero, poster, minimal)
4. Add feed section components (featured, trending, by_category)
5. Build visual configurator in portal admin UI
